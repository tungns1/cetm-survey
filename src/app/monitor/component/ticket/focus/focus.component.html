<div id="focusComponent" *ngIf="data">
    <h2 class="header uppercase"> {{data.branch_id | branchName}} </h2>
    <div class="nav">
        <button class="btnClear btnMargin uppercase" (click)="goBackBranchList()">go back</button>
    </div>

    <div class="overview border padding-20" fxLayout="row" fxLayoutGap="30px">
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Branch:</span>:
                <span>{{data.parent_id | branchName}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Admin:</span>
                <span>Nguyễn Trường Minh</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Manager:</span>
                <span>Nguyễn Sỹ Trung</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Total counter:</span>
                <span> {{numberCounter$ | async}} </span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Total counter on:</span>
                <span> {{numberCounterOn$ | async}} </span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Total counter off:</span>
                <span>{{numberCounterOff$ | async}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Ticket print:</span>
                <span>{{data.printed}}</span>
            </div>
        </div>
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of waiting tickets:</span>
                <span>{{data.waiting}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of tickets being served:</span>
                <span>{{data.serving}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of tickets already served:</span>
                <span>{{data.finished}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of reserved tickets:</span>
                <span>{{data.missed}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of cancelled tickets:</span>
                <span>{{data.cancelled}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Serving over 15':</span>
                <span>{{data.wait_long}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Serving under 2':</span>
                <span>{{data.serve_short}}</span>
            </div>
        </div>
    </div>

    <div class="divider margin-30-0"></div>

    <div class="border">
        <monitor-chart [data]="data"></monitor-chart>
    </div>

    <h3 i18n>Services incomplete</h3>

    <table class="tableCtrl">
        <thead>
            <th i18n>No.</th>
            <th i18n>Service name</th>
            <th i18n>Ticket number</th>
            <th i18n>Customer</th>
            <th i18n>Print time</th>
            <th i18n>Waiting time</th>
            <th i18n>Detail</th>
        </thead>
        <tbody>
            <tr *ngFor="let t of waitingAndMissed$ | async ; let i = index" [ngClass]="{'missed': t.state === 'missed', 'waiting': t.state === 'waiting'}">
                <td> {{i + 1}} </td>
                <td> {{t.services | multipleServiceName}}</td>
                <td> {{t.cnum}}</td>
                <td *ngIf="t.customer"> {{t.customer.full_name }} </td>
                <td *ngIf="!t.customer"> </td>
                <td> {{t.ctime | localDayTime}}</td>
                <td *ngIf="t.state === 'waiting'">
                    <timer [start]="t.mtime" [timeWarning]="15"></timer>
                </td>
                <td *ngIf="t.state === 'missed'"> {{t.mtime - t.ctime | timeDuration}}</td>
                <td>
                    <span (click)="detail(t)">
                        <img class="iconDetail" src="./assets/img/icon/play.png" (click)="detail.SetData(d);detail.GetInfoCustomer(d)" alt="Search" style="cursor: pointer">
                    </span>
                </td>
            </tr>
        </tbody>
    </table>

    <h3 i18n>Services completed</h3>

    <table class="tableCtrl">
        <thead>
            <th i18n>No.</th>
            <th i18n>Service</th>
            <th i18n>Counter</th>
            <th i18n>Tellers</th>
            <th i18n>Ticket number</th>
            <th i18n>Customer</th>
            <th i18n>Print time</th>
            <th i18n>Waiting time</th>
            <th i18n>Serving time</th>
            <th i18n>Detail</th>
        </thead>
        <tbody>
            <tr *ngFor="let t of servingNServed$ | async; let i = index" [ngClass]="{'cancelled': t.state === 'cancelled', 'serving': t.state === 'serving', 'serveDone': t.state === 'finished' || t.state === 'waiting'}">
                <td> {{i + 1}} </td>
                <td> {{t.service_id | serviceName}} </td>
                <td> {{t.counter_id | counterName}}</td>
                <td> {{t.user_id | userFullName}}</td>
                <td> {{t.cnum}} </td>
                <td *ngIf="t.customer"> {{t.customer.full_name }} </td>
                <td *ngIf="!t.customer"> </td>
                <td> {{t.ctime | localDayTime}}</td>
                <td> {{t.mtime - t.ctime | timeDuration}} </td>

                <td *ngIf="t.state === 'serving'">
                    <timer [start]="t.mtime" [timeWarning]="1"></timer>
                </td>
                <td *ngIf="t.state != 'serving'"> {{t.stime | timeDuration}} </td>
                <td>
                    <span (click)="detail(t)">
                        <img class="iconDetail" src="./assets/img/icon/play.png" (click)="detail.SetData(d);detail.GetInfoCustomer(d)" alt="Search" style="cursor: pointer">
                    </span>
                    <span>
                        <img class="iconDetail" src="./assets/img/icon/volume.png" (click)="detail.SetData(d);detail.GetInfoCustomer(d)" alt="Search" style="cursor: pointer">
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<modal #edit id="modal_monitor_detailTicket">
    <h3 class="modal-header" i18n>Ticket detail</h3>
    <div *ngIf="selectedTicket" class="modalContent">
        <!--<div fxLayout="row" fxLayoutGap="20px">
            <div fxFlex>-->
        <table>
            <tr>
                <th i18n>Ticket number</th>
                <th>{{selectedTicket.cnum}}</th>
            </tr>
            <tr>
                <th i18n>State</th>
                <th>{{selectedTicket.state | uppercaseFirst}}</th>
            </tr>
            <tr>
                <th i18n>Service</th>
                <td> {{selectedTicket.service_id | serviceName}} </td>
                <!--<td> {{t.selectedTicket | serviceName}} </td>-->
                <!--<th>
                    <span *ngIf="!isServed">{{selectedTicket.services[0] | serviceName}}</span>
                    <span *ngIf="isServed">{{selectedTicket.serving.service_id | serviceName}}</span>
                </th>-->
            </tr>
            <tr>
                <th i18n>Print time</th>
                <th>{{selectedTicket.ctime | localDayTime}}</th>
            </tr>
            <tr>
                <th i18n>Waiting time</th>
                <th>
                    <span *ngIf="!isServed && selectedTicket.state === 'waiting'"><timer [start]="selectedTicket.mtime" [timeWarning]="15"></timer></span>
                    <span *ngIf="!isServed && selectedTicket.state === 'missed'">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
                    <span *ngIf="isServed">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
                </th>
            </tr>
            <tr *ngIf="isServed">
                <th i18n>Serving time</th>
                <th *ngIf="selectedTicket.state === 'serving'">
                    <timer [start]="selectedTicket.mtime" [timeWarning]="1"></timer>
                </th>
                <th *ngIf="selectedTicket.state != 'serving'"> {{selectedTicket.stime | timeDuration}} </th>
            </tr>
        </table>
        <!--</div>
            <div fxFlex>-->
        <table>
            <tr>
                <th i18n>Branch</th>
                <th i18n>{{selectedTicket.branch_id | branchName}}</th>
            </tr>
            <tr>
                <th i18n>Store</th>
                <th i18n>{{selectedTicket.branch_id | branchName}}</th>
            </tr>
            <tr>
                <th i18n>Tellers</th>
                <td *ngIf="selectedTicket.state != 'waiting'"> {{selectedTicket.user_id | userFullName}}</td>
            </tr>
            <tr>
                <th i18n>Counter</th>
                <td *ngIf="selectedTicket.state != 'waiting'"> {{selectedTicket.counter_id | counterName}}</td>
            </tr>
            <tr *ngIf="selectedTicket.serving">
                <th i18n>Manager</th>
                <th>testing</th>
            </tr>
            <tr *ngIf="selectedTicket.serving">
                <th i18n>Administrator</th>
                <th>testing</th>
            </tr>
        </table>
        <!--</div>
        </div>-->
        <table *ngIf="customer">
            <tr>
                <th i18n>Counter name</th>
                <th> {{customer.full_name }}</th>
            </tr>
            <tr>
                <th i18n>Code/ID</th>
                <th> {{customer.code }}</th>
            </tr>
            <tr>
                <th i18n>Phone number</th>
                <th> {{customer.phone_number }}</th>
            </tr>
            <tr>
                <th i18n>Segment</th>
                <th> {{customer.segment }}</th>
            </tr>
        </table>

        <!--<div fxLayout="row" fxLayoutGap="20px">
            <div fxFlex i18n>Ticket number</div>
            <div fxFlex>{{selectedTicket.cnum}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>State</div>
            <div>{{selectedTicket.state}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>Service</div>
            <div>
                <span *ngIf="!isServed">{{selectedTicket.services[0] | serviceName}}</span>
                <span *ngIf="isServed">{{selectedTicket.serving.service_id | serviceName}}</span>
            </div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>Time of ticket printed</div>
            <div>{{selectedTicket.ctime | localDayTime}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>Waiting time</div>
            <div>
                <span *ngIf="!isServed && selectedTicket.state === 'waiting'"><timer [start]="selectedTicket.mtime" [timeWarning]="15"></timer></span>
                <span *ngIf="!isServed && selectedTicket.state === 'missed'">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
                <span *ngIf="isServed">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
            </div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="isServed">
            <div i18n>Serving time</div>
            <div *ngIf="selectedTicket.state === 'serving'">
                <timer [start]="selectedTicket.mtime" [timeWarning]="1"></timer>
            </div>
            <div *ngIf="selectedTicket.state != 'serving'"> {{selectedTicket.stime | timeDuration}} </div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>Branch</div>
            <div i18n>{{selectedTicket.branch_id | branchName}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px">
            <div i18n>Store</div>
            <div i18n>{{selectedTicket.branch_id | branchName}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div i18n>Tellers</div>
            <div>{{selectedTicket.serving.user_id | userFullName}}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div i18n>Counter</div>
            <div>{{selectedTicket.serving.counter_id | counterName }}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div i18n>Manager</div>
            <div>testing</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div i18n>Administrator</div>
            <div>testing</div>
        </div>

        <div fxLayout="row" fxLayoutGap="20px" *ngIf="customer">
            <div i18n>Name Counter</div>
            <div> {{customer.full_name }}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="customer">
            <div i18n>Code ID</div>
            <div> {{customer.code }}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="customer">
            <div i18n>Number Phone</div>
            <div> {{customer.phone_number }}</div>
        </div>
        <div fxLayout="row" fxLayoutGap="20px" *ngIf="customer">
            <div i18n>Segment</div>
            <div> {{customer.segment }}</div>
        </div>-->

        <button class="btnFill uppercase" (click)="closeModal()" i18n>Close</button>
    </div>
</modal>