<div id="focusComponent" *ngIf="focus$ | async; let data">
    <h2 class="header uppercase"> {{data.branch_id | branchName}} </h2>
    <div class="nav">
        <button class="btnClear btnMargin uppercase" (click)="goBackBranchList()">go back</button>
    </div>
    <div class="overview border padding-20" fxLayout="row" fxLayoutGap="30px">
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Branch</span>
                <span>{{data.parent_id | branchName}}</span>
            </div>
            <div *ngIf="admin" fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Admin</span>
                <span *ngIf="admin[0]">{{admin[0].fullname}}</span>
            </div>
            <div *ngIf="manager" fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Manager</span>
                <span *ngIf="manager[0]">{{manager[0].fullname}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Total counter</span>
                <span> {{numberCounter$ | async}} </span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Total counter on</span>
                <span> {{numberCounterOn$ | async}} </span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Total counter off</span>
                <span>{{numberCounterOff$ | async}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Print ticket</span>
                <span>{{data.printed}}</span>
            </div>
        </div>
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of waiting tickets</span>
                <span>{{data.waiting}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of tickets being served</span>
                <span>{{data.serving}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of tickets already served</span>
                <span>{{data.finished}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of reserved tickets</span>
                <span>{{data.missed}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Number of cancelled tickets</span>
                <span>{{data.cancelled}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Waiting over 15'</span>
                <span>{{data.wait_long}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span i18n>Serving over 15'</span>
                <span>{{data.s_l}}</span>
            </div>
        </div>
    </div>

    <div class="divider margin-30-0"></div>

    <div class="border">
        <monitor-chart [data]="data"></monitor-chart>
    </div>
</div>

<h3 i18n>Services incomplete</h3>

<table class="tableCtrl">
    <thead>
        <th i18n>No.</th>
        <th i18n>Service Name</th>
        <th i18n>Ticket number</th>
        <th i18n>Customer</th>
        <th i18n>Print time</th>
        <th i18n>Waiting Time</th>
        <th i18n>Detail</th>
    </thead>
    <tbody>
        <tr *ngFor="let t of waitingAndMissed$ | async ; let i = index" [ngClass]="{'missed': t.state === 'missed', 'waiting': t.state === 'waiting'}">
            <td> {{i + 1}} </td>
            <td> {{t.services | multipleServiceName}}</td>
            <td> {{t.cnum}}</td>
            <td> {{t.customer?.full_name }} </td>
            <td> {{t.ctime | localDayTime}}</td>
            <td *ngIf="t.state === 'waiting'">
                <timer [start]="t.mtime" [timeWarning]="15"></timer>
            </td>
            <td *ngIf="t.state === 'missed'"> {{t.mtime - t.ctime | timeDuration}}</td>
            <td>
                <span (click)="detail(t)">
                    <img class="iconDetail" src="./assets/img/icon/play.png" alt="Search" style="cursor: pointer">
                </span>
            </td>
        </tr>
    </tbody>
</table>

<h3 i18n>Services completed</h3>

<table class="tableCtrl">
    <thead>
        <th i18n>No.</th>
        <th i18n>Service</th>
        <th i18n>Counter</th>
        <th i18n>Tellers</th>
        <th i18n>Ticket number</th>
        <th i18n>Customer</th>
        <th i18n>Print time</th>
        <th i18n>Waiting Time</th>
        <th i18n>Serving time</th>
        <th i18n>Detail</th>
    </thead>
    <tbody>
        <tr *ngFor="let t of servingNServed$ | async; let i = index" [ngClass]="{'cancelled': t.state === 'cancelled', 'serving': t.state === 'serving', 'serveDone': t.state === 'finished' || t.state === 'waiting'}">
            <td> {{i + 1}} </td>
            <td> {{t.service_id | serviceName}} </td>
            <td> {{t.counter_id | counterName}}</td>
            <td> {{t.user_id | userFullName}}</td>
            <td> {{t.cnum}} </td>
            <td *ngIf="t.customer"> {{t.customer.full_name }} </td>
            <td *ngIf="!t.customer"> </td>
            <td> {{t.ctime | localDayTime}}</td>
            <td> {{t.mtime - t.ctime | timeDuration}} </td>
            <td *ngIf="t.state == 'serving'">
                <timer [start]="t.mtime" [timeWarning]="1"></timer>
            </td>
            <td *ngIf="t.state != 'serving'"> {{t.stime | timeDuration}} </td>
            <td>
                <span (click)="detail(t)">
                        <img class="iconDetail" src="./assets/img/icon/play.png" alt="Search" style="cursor: pointer">
                    </span>
                <span>
                        <img class="iconDetail" src="./assets/img/icon/volume.png" alt="Search" style="cursor: pointer">

                    </span>
            </td>
        </tr>
    </tbody>
</table>

<modal #edit id="modal_monitor_detailTicket">
    <h3 class="modal-header" i18n>Ticket detail</h3>
    <div *ngIf="selectedTicket" class="modalContent padding-10-20">

        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Ticket number</div>
            <div fxFlex>{{selectedTicket.cnum}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>State</div>
            <div fxFlex>{{selectedTicket.state}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Service</div>
            <div fxFlex>
                <span *ngIf="!isServed">{{selectedTicket.services[0] | serviceName}}</span>
                <span *ngIf="isServed">{{selectedTicket.serving.service_id | serviceName}}</span>
            </div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Time of ticket printed</div>
            <div fxFlex>{{selectedTicket.ctime | localDayTime}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Waiting time</div>
            <div fxFlex>
                <span *ngIf="!isServed && selectedTicket.state === 'waiting'"><timer [start]="selectedTicket.mtime" [timeWarning]="15"></timer></span>
                <span *ngIf="!isServed && selectedTicket.state === 'missed'">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
                <span *ngIf="isServed">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
            </div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="isServed">
            <div fxFlex i18n>Serving time</div>
            <div fxFlex>
                <timer *ngIf="selectedTicket.state === 'serving'" [start]="selectedTicket.mtime" [timeWarning]="1"></timer>
                <div *ngIf="selectedTicket.state != 'serving'"> {{selectedTicket.stime | timeDuration}} </div>
            </div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Branch</div>
            <div fxFlex i18n>{{selectedTicket.branch_id | branchName}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px">
            <div fxFlex i18n>Store</div>
            <div fxFlex i18n>{{selectedTicket.branch_id | branchName}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div fxFlex i18n>Tellers</div>
            <div fxFlex>{{selectedTicket.serving.user_id | userFullName}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div fxFlex i18n>Counter</div>
            <div fxFlex>{{selectedTicket.serving.counter_id | counterName }}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div fxFlex i18n>Manager</div>
            <div fxFlex>{{selectedTicket.manager.fullname}}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="selectedTicket.serving">
            <div fxFlex i18n>Administrator</div>
            <div fxFlex>{{selectedTicket.admin.fullname}}</div>
        </div>

        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="customer">
            <div fxFlex i18n>Customer name</div>
            <div fxFlex> {{customer.full_name }}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="customer">
            <div fxFlex i18n>Code ID</div>
            <div fxFlex> {{customer.code }}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="customer">
            <div fxFlex i18n>Number phone</div>
            <div fxFlex> {{customer.phone_number }}</div>
        </div>
        <div fxLayout="row" class="margin-t-10" fxLayoutGap="20px" *ngIf="customer">
            <div fxFlex i18n>Segment</div>
            <div fxFlex> {{customer.segment }}</div>
        </div>

        <button class="btnFill uppercase" (click)="closeModal()" i18n>Close</button>
    </div>
</modal>