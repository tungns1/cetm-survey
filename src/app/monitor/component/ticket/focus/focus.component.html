<div id="focusComponent" *ngIf="data">
    <div class="flex-container header" fxLayout="row" fxLayoutAlign="space-between none">
        <h1 fxFlex> {{data.branch_id | branchName}} </h1>
        <h3 fxFlex="10%" (click)="goBackBranchList()" class="btn_back"><i _ngcontent-lat-10="" class="fa fa-angle-double-left"> </i>Go back</h3>
    </div>
    <div class="flex-container overview" fxLayout="row" fxLayoutAlign="space-between none">
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span translate>LANGAUGE_BRANCH </span>:
                <span>{{data.parent_id | branchName}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Admin: </span>
                <span>Testing</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Manager: </span>
                <span>Testing</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Tổng số quầy: </span>
                <span>Testing</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Tổng số quầy đang bật: </span>
                <span>Testing</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Tổng số quầy đang tắt: </span>
                <span>Testing</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đã in: </span>
                <span>{{data.printed}}</span>
            </div>
        </div>
        <div fxLayout="column" fxFlex class="padding_monitor">
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đang đợi: </span>
                <span>{{data.waiting}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đang được phục vụ: </span>
                <span>{{data.serving}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đã được phục vụ: </span>
                <span>{{data.finished}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đặt nhỡ: </span>
                <span>{{data.missed}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé hủy: </span>
                <span>{{data.cancelled}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé đợi trên 15': </span>
                <span>{{data.wait_long}}</span>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between none">
                <span>Số lượng vé được phục vụ dưới 2': </span>
                <span>{{data.serve_short}}</span>
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <monitor-chart [data]="data"></monitor-chart>

    <h3 class="tableHeader"> Khách hàng chưa được phục vụ </h3>

    <table class="table">
        <thead>
            <th> STT </th>
            <th translate>LANGAUGE_SERVICE </th>
            <th translate> LANGAUGE_TICKET_NUMBER </th>
            <th translate>LANGAUGE_CUSTOMER </th>
            <th translate> LANGAUGE_TIME_CREATE_TICKET</th>
            <th translate> LANGAUGE_TIME_WAIT</th>
            <th translate> LANGAUGE_DETAIL </th>
        </thead>
        <tbody>
            <tr *ngFor="let t of waitingAndMissed$ | async ; let i = index" [ngClass]="{'missed': t.state === 'missed', 'waiting': t.state === 'waiting'}">
                <td> {{i + 1}} </td>
                <td> {{t.services | multipleServiceName}}</td>
                <td> {{t.cnum}}</td>
                <td> {{t.customer.full_name }} </td>
                <td> {{t.ctime | localDayTime}}</td>
                <td *ngIf="t.state === 'waiting'">
                    <timer [start]="t.mtime" [timeWarning]="15"></timer>
                </td>
                <td *ngIf="t.state === 'missed'"> {{t.mtime - t.ctime | timeDuration}}</td>
                <td>
                    <span (click)="detail(t)">
                        <i class="fa fa-eye" aria-hidden="true" style="cursor: pointer"></i>
                    </span>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="divider"></div>

    <h3 class="tableHeader"> Khách hàng đã được phục vụ </h3>

    <table class="table">
        <thead>
            <th> STT </th>
            <th translate>LANGAUGE_SERVICE </th>
            <th translate>LANGAUGE_COUNTERS</th>
            <th translate>LANGAUGE_TELLERS</th>
            <th translate> LANGAUGE_TICKET_NUMBER </th>
            <th translate> LANGAUGE_CUSTOMER </th>
            <th translate> LANGAUGE_TIME_CREATE_TICKET</th>
            <th translate> LANGAUGE_TIME_WAIT </th>
            <th translate>LANGAUGE_TIME_SERVING </th>
            <th translate> LANGAUGE_DETAIL </th>
        </thead>
        <tbody>
            <tr *ngFor="let t of servingNServed$ | async; let i = index" [ngClass]="{'cancelled': t.state === 'cancelled', 'serving': t.state === 'serving', 'serveDone': t.state === 'finished' || t.state === 'waiting'}">
                <td> {{i + 1}} </td>
                <td *ngIf="t.serving"> {{t.serving.service_id | serviceName}} </td>
                <td *ngIf="t.serving"> {{t.serving.counter_id | counterName}}</td>
                <td *ngIf="t.serving"> {{t.serving.user_id | userFullName}}</td>

                <td *ngIf="!t.serving">{{t.service_id | serviceName}}</td>
                <td *ngIf="!t.serving">{{t.counter_id | counterName}}</td>
                <td *ngIf="!t.serving">{{t.user_id | userFullName}}</td>

                <td> {{t.cnum}} </td>
                <td> {{t.customer.full_name }} </td>
                <td> {{t.ctime | localDayTime}}</td>
                <td *ngIf="t.serving"> {{t.serving.mtime - t.ctime | timeDuration}} </td>
                <td *ngIf="!t.serving"> {{t.mtime - t.ctime | timeDuration}} </td>

                <td *ngIf="t.state === 'serving'">
                    <timer [start]="t.mtime" [timeWarning]="1"></timer>
                </td>
                <td *ngIf="t.state != 'serving'"> {{t.stime | timeDuration}} </td>
                <td>
                    <span (click)="detail(t)">
                        <i class="fa fa-eye" aria-hidden="true" style="cursor: pointer"></i>
                    </span>
                    <span>
                        <i class="fa fa-volume-down" aria-hidden="true" style="cursor: pointer"></i>
                    </span>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<div class="divider"></div>

<modal #edit id="modal_monitor_detailTicket">
    <div *ngIf="selectedTicket">
        <h3 class="header" translate>LANGAUGE_TICKET_DETAIL</h3>
        <div class="twoColumn">
            <table>
                <tr>
                    <th translate> LANGAUGE_TICKET_NUMBER </th>
                    <th>{{selectedTicket.cnum}}</th>
                </tr>
                <tr>
                    <th translate> LANGAUGE_STATE </th>
                    <th>{{selectedTicket.state}}</th>
                </tr>
                <tr>
                    <th translate> LANGAUGE_SERVICE </th>
                    <th>
                        <span *ngIf="!isServed">{{selectedTicket.services[0] | serviceName}}</span>
                        <span *ngIf="isServed">{{selectedTicket.serving.service_id | serviceName}}</span>
                    </th>
                </tr>
                <tr>
                    <th translate> LANGAUGE_TIME_CREATE_TICKET </th>
                    <th>{{selectedTicket.ctime | localDayTime}}</th>
                </tr>
                <tr>
                    <th translate> LANGAUGE_TIME_WAIT </th>
                    <th>
                        <span *ngIf="!isServed"><timer [start]="selectedTicket.mtime" [timeWarning]="15"></timer></span>
                        <span *ngIf="isServed">{{selectedTicket.mtime - selectedTicket.ctime | timeDuration}}</span>
                    </th>
                </tr>
                <tr>
                    <th translate>LANGAUGE_DATE </th>
                    <th>{{selectedTicket.ctime | localDayTime}}</th>
                </tr>
            </table>
        </div>

        <div class="twoColumn" [ngClass]="{'notServeYet': !isServed}">
            <table>
                <tr>
                    <th translate> LANGAUGE_BRANCH </th>
                    <th translate>{{selectedTicket.branch_id | branchName}}</th>
                </tr>
                <tr>
                    <th translate> LANGAUGE_STORE </th>
                    <th translate>{{selectedTicket.branch_id | branchName}}</th>
                </tr>
                <tr *ngIf="selectedTicket.serving">
                    <th translate> LANGAUGE_TELLERS </th>
                    <th>{{selectedTicket.serving.user_id | userFullName}}</th>
                </tr>
                <tr *ngIf="selectedTicket.serving">
                    <th translate> LANGAUGE_COUNTERS </th>
                    <th>{{selectedTicket.serving.counter_id | counterName }}</th>
                </tr>
                <tr *ngIf="selectedTicket.serving">
                    <th translate> LANGAUGE_MANAGER </th>
                    <th>testing</th>
                </tr>
                <tr *ngIf="selectedTicket.serving">
                    <th translate> LANGAUGE_ADDMINISTRATOR </th>
                    <th>testing</th>
                </tr>
            </table>
        </div>
        <table *ngIf="customer">
            <tr>
                <th translate> LANGAUGE_CUSTOMER_NAME </th>
                <th>{{customer.full_name }}</th>
            </tr>
            <tr>
                <th translate> LANGAUGE_CODE_ID </th>
                <th>{{customer.code }}</th>
            </tr>
            <tr>
                <th translate> LANGAUGE_NUMBER_PHONE </th>
                <th>{{customer.phone_number }}</th>
            </tr>
            <tr>
                <th translate> LANGAUGE_SEGMENT </th>
                <th>{{customer.segment }}</th>
            </tr>
        </table>

        <button (click)="closeModal()" style="float: right;">Close</button>
    </div>
</modal>